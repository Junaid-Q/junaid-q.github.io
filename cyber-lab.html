<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cyber Research Lab - Dr. Junaid Qadir</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
        }

        #infoPanel {
            position: absolute;
            top: 20px;
            left: 20px;
            max-width: 320px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.65);
            border: 1px solid cyan;
            color: white;
            border-radius: 10px;
            display: none;
            font-family: Arial;
        }

        #closeBtn {
            float: right;
            cursor: pointer;
            color: cyan;
        }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://threejs.org/examples/js/controls/PointerLockControls.js"></script>
</head>

<body>

    <div id="infoPanel">
        <span id="closeBtn">X</span>
        <h3 id="panelTitle"></h3>
        <p id="panelText"></p>
    </div>

    <script>
        /* -------------------------------------------------------
           Basic Scene Setup
        ------------------------------------------------------- */
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 1.6, 5);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        /* -------------------------------------------------------
           Lighting
        ------------------------------------------------------- */
        const ambient = new THREE.AmbientLight(0x66ffff, 0.5);
        scene.add(ambient);

        const spot = new THREE.SpotLight(0x00ffff, 2);
        spot.position.set(5, 10, 5);
        scene.add(spot);

        /* -------------------------------------------------------
           Room Environment
        ------------------------------------------------------- */
        const floorGeo = new THREE.PlaneGeometry(30, 30);
        const floorMat = new THREE.MeshStandardMaterial({
            color: 0x001a1a,
            emissive: 0x004040
        });
        const floor = new THREE.Mesh(floorGeo, floorMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        const wallMat = new THREE.MeshStandardMaterial({ color: 0x001020 });
        const wallGeo = new THREE.BoxGeometry(30, 10, 1);

        const backWall = new THREE.Mesh(wallGeo, wallMat);
        backWall.position.set(0, 5, -15);
        scene.add(backWall);

        const frontWall = new THREE.Mesh(wallGeo, wallMat);
        frontWall.position.set(0, 5, 15);
        scene.add(frontWall);

        /* -------------------------------------------------------
           Research Objects (Clickable)
        ------------------------------------------------------- */
        const objects = [];
        function makeObject(x, y, z, color, name, info) {
            const geo = new THREE.BoxGeometry(1, 1, 1);
            const mat = new THREE.MeshStandardMaterial({ color });
            const obj = new THREE.Mesh(geo, mat);
            obj.position.set(x, y, z);
            obj.userData = { name, info };
            scene.add(obj);
            objects.push(obj);
        }

        makeObject(-5, 1, -5, 0x00ffff, "IMU Sensor Table",
            "This station visualizes IMU balance data and deep-learning CoP prediction.");

        makeObject(5, 1, -5, 0xff00ff, "LoRaWAN Gateway Rack",
            "Shows LoRaWAN security, attacks, and key-management demonstration.");

        makeObject(-5, 1, 5, 0x00ff88, "Deep Learning Hologram",
            "Displays neural network activations and model interpretation.");

        makeObject(5, 1, 5, 0xffff00, "5G Edge Server",
            "Demonstrates latency modeling and virtualized network function behaviour.");

        makeObject(0, 1, 0, 0x3399ff, "UWSN Capsule",
            "Shows underwater sensor routing, delay minimization, and cooperation models.");

        /* -------------------------------------------------------
           Pointer Lock (FPS Controls)
        ------------------------------------------------------- */
        const controls = new THREE.PointerLockControls(camera, document.body);

        document.body.addEventListener('click', () => {
            controls.lock();
        });

        /* Movement */
        let move = { forward: false, back: false, left: false, right: false };
        document.addEventListener('keydown', e => {
            if (e.code === 'KeyW') move.forward = true;
            if (e.code === 'KeyS') move.back = true;
            if (e.code === 'KeyA') move.left = true;
            if (e.code === 'KeyD') move.right = true;
        });
        document.addEventListener('keyup', e => {
            if (e.code === 'KeyW') move.forward = false;
            if (e.code === 'KeyS') move.back = false;
            if (e.code === 'KeyA') move.left = false;
            if (e.code === 'KeyD') move.right = false;
        });

        /* -------------------------------------------------------
           Raycasting for Clicking Objects
        ------------------------------------------------------- */
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();

        function checkInteraction() {
            raycaster.setFromCamera(new THREE.Vector2(0, 0), camera);
            const hits = raycaster.intersectObjects(objects);
            if (hits.length > 0) {
                const o = hits[0].object.userData;
                openPanel(o.name, o.info);
            }
        }

        document.addEventListener("click", () => {
            if (!controls.isLocked) return;
            checkInteraction();
        });

        /* -------------------------------------------------------
           Info Panel
        ------------------------------------------------------- */
        function openPanel(title, text) {
            document.getElementById("panelTitle").textContent = title;
            document.getElementById("panelText").textContent = text;
            document.getElementById("infoPanel").style.display = "block";
        }

        document.getElementById("closeBtn").onclick = () => {
            document.getElementById("infoPanel").style.display = "none";
        };

        /* -------------------------------------------------------
           Animation Loop
        ------------------------------------------------------- */
        function animate() {
            requestAnimationFrame(animate);

            let speed = 0.10;

            if (controls.isLocked) {
                if (move.forward) controls.moveForward(speed);
                if (move.back) controls.moveForward(-speed);
                if (move.left) controls.moveRight(-speed);
                if (move.right) controls.moveRight(speed);
            }

            renderer.render(scene, camera);
        }
        animate();

        /* Resize */
        window.addEventListener("resize", () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>

</body>

</html>